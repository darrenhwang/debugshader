# Cocos Creator 3.8 着色器异常加载问题归档

## 问题一：Uniform Buffer 未绑定

### 错误信息
```
GL_INVALID_OPERATION: It is undefined behaviour to have a used but unbound uniform buffer
```

### 问题代码
```glsl
uniform FSBlock {
  vec4 tilingOffset;
  vec4 color;
};
```

### 解决方案
1. 确保属性定义中包含正确的 target 绑定
2. 使用标准的 Constant 块名称
3. 移除不必要的 uniform 变量

## 问题二：属性绑定错误

### 错误信息
```
Property color has no value
```

### 问题代码
```glsl
properties:
  color: { value: [1, 1, 1, 1], target: color.value, editor: { type: color } }
```

### 解决方案
1. 移除 color 属性，使用精灵组件的 Color 属性
2. 使用内置的 Sprite 着色器结构
3. 确保使用正确的 uniform 块名称和属性名称

### 修复示例
```glsl
CCEffect %{
  techniques:
  - name: transparent
    passes:
    - vert: sprite-vs:vert
      frag: sprite-fs:frag
      properties:
        mainTexture: { value: grey }
}%
```

## 问题三：着色器加载失败

### 现象
- 着色器文件修改后不能被正确加载
- ShaderChecker 显示 handle 正常但精灵不显示

### 可能原因
1. include 路径不正确
2. uniform 块定义不匹配
3. 缺少必要的宏定义
4. 属性绑定不完整
5. 使用了不支持的特性或语法

### 解决方案
1. 使用正确的 include 路径：
   ```glsl
   #include <builtin/uniforms/cc-global>
   #include <builtin/uniforms/cc-local>
   #include <builtin/internal/sprite-texture>
   ```
2. 使用标准的 Sprite 着色器结构
3. 简化着色器代码，移除不必要的功能
4. 使用内置的 alpha 测试和纹理采样函数
5. 确保混合模式正确设置

### 标准结构示例
```glsl
CCProgram sprite-fs %{
  #include <builtin/uniforms/cc-global>
  #include <builtin/internal/sprite-texture>
  
  in vec2 v_uv0;
  in vec4 v_color;

  vec4 frag () {
    vec4 o = CCSampleWithAlphaSeparated(mainTexture, v_uv0);
    o *= v_color;
    return o;
  }
}%
``` 